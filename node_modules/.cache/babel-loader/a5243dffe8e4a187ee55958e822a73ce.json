{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useContext}from'react';import Context from'../store/Context';import sha256 from'crypto-js/sha256';import{Form,Button}from'semantic-ui-react';import RecordVerified from'./RecordVerified';var Verify=function Verify(){var _useContext=useContext(Context),state=_useContext.state,dispatch=_useContext.dispatch;var fileInputRef=useRef();var _useState=useState(),_useState2=_slicedToArray(_useState,2),hash=_useState2[0],setHash=_useState2[1];var handleFileChange=function handleFileChange(e){var file=e.target.files[0];var reader=new window.FileReader();reader.readAsBinaryString(file);reader.onloadend=function(){setHash(sha256(reader.result).toString());};document.getElementById('buttonChooseFile').innerHTML=\"<i aria-hidden=\\\"true\\\" class=\\\"file icon\\\"></i>\".concat(file.name);};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var record,index,institution,data,records;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;dispatch({type:'SET_LOADING',payload:true});_context.next=5;return state.contract.methods.getRecord(hash).call();case 5:record=_context.sent;if(!record.hash){_context.next=18;break;}_context.next=9;return state.contract.methods.getInstitutionIndex(record.institution).call();case 9:index=_context.sent;_context.next=12;return state.contract.methods.institutions(index).call();case 12:institution=_context.sent;data=_toConsumableArray(record);data.push(institution.name);dispatch({type:'SET_RECORD_VERIFIED',payload:data});_context.next=19;break;case 18:dispatch({type:'SET_RECORD_VERIFIED',payload:{msg:'Unavailable to verify.'}});case 19:dispatch({type:'SET_NOTIF',payload:{msg:'record added.',success:true}});_context.next=22;return state.contract.methods.getRecords().call();case 22:records=_context.sent;dispatch({type:'SET_RECORDS',payload:records});_context.next=29;break;case 26:_context.prev=26;_context.t0=_context[\"catch\"](1);dispatch({type:'SET_NOTIF',payload:{msg:_context.t0.message,success:false}});case 29:_context.prev=29;dispatch({type:'SET_LOADING',payload:false});return _context.finish(29);case 32:case\"end\":return _context.stop();}}},_callee,null,[[1,26,29,32]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Form,{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"File\"),/*#__PURE__*/React.createElement(\"input\",{ref:fileInputRef,type:\"file\",hidden:true,onChange:handleFileChange,required:true}),/*#__PURE__*/React.createElement(Button,{id:\"buttonChooseFile\",content:\"Choose File\",labelPosition:\"left\",icon:\"file\",onClick:function onClick(){return fileInputRef.current.click();}})),/*#__PURE__*/React.createElement(Button,{type:\"submit\"},\"Submit\")),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(RecordVerified,null));};export default Verify;","map":{"version":3,"sources":["/Users/zaralaila/Desktop/sijil/src/components/Verify.js"],"names":["React","useRef","useState","useContext","Context","sha256","Form","Button","RecordVerified","Verify","state","dispatch","fileInputRef","hash","setHash","handleFileChange","e","file","target","files","reader","window","FileReader","readAsBinaryString","onloadend","result","toString","document","getElementById","innerHTML","name","handleSubmit","preventDefault","type","payload","contract","methods","getRecord","call","record","getInstitutionIndex","institution","index","institutions","data","push","msg","success","getRecords","records","message","current","click"],"mappings":"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","sourcesContent":["import React, {useRef, useState, useContext} from 'react';\nimport Context from '../store/Context';\nimport sha256 from 'crypto-js/sha256';\nimport {Form, Button} from 'semantic-ui-react';\nimport RecordVerified from './RecordVerified';\n\nconst Verify = () => {\n  const {state, dispatch} = useContext(Context);\n\tconst fileInputRef = useRef();\n  const [hash, setHash] = useState();\n\n  const handleFileChange = e => {\n    const file = e.target.files[0];\n    const reader = new window.FileReader();\n    reader.readAsBinaryString(file);\n    reader.onloadend = () => {\n      setHash(sha256(reader.result).toString());\n    }\n\t\tdocument.getElementById('buttonChooseFile')\n\t\t\t.innerHTML = `<i aria-hidden=\"true\" class=\"file icon\"></i>${file.name}`;\n  }\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    try {\n      dispatch({type: 'SET_LOADING', payload: true});\n\t\t\tconst record = await state.contract.methods\n        .getRecord(hash).call();\n\t\t\tif(record.hash) {\n\t\t\t\tconst index = await state.contract.methods\n\t\t\t\t\t.getInstitutionIndex(record.institution).call();\n\t\t\t\tconst institution = await state.contract.methods\n\t\t\t\t\t.institutions(index).call();\n\t\t\t\tconst data = [...record];\n\t\t\t\tdata.push(institution.name);\n\t\t\t\tdispatch({type: 'SET_RECORD_VERIFIED', payload: data});\n\t\t\t} else {\n\t\t\t\tdispatch({type: 'SET_RECORD_VERIFIED', payload: {msg: 'Unavailable to verify.'}});\n\t\t\t}\n      dispatch({\n        type: 'SET_NOTIF',\n        payload: {msg: 'record added.', success: true}\n      });\n\t\t\tconst records = await state.contract.methods\n\t\t\t\t.getRecords().call();\n\t\t\tdispatch({\n\t\t\t\ttype: 'SET_RECORDS',\n\t\t\t\tpayload: records\n\t\t\t});\n    } catch (error) {\n      dispatch({\n        type: 'SET_NOTIF',\n        payload: {msg: error.message, success: false}\n      });\n    } finally {\n      dispatch({type: 'SET_LOADING', payload: false});\n    }\n  }\n\n  return (\n\t\t<>\n    <Form onSubmit={handleSubmit}>\n      <Form.Field>\n\t\t\t\t<label>File</label>\n        <input\n\t\t\t\t\tref={fileInputRef}\n          type='file'\n          hidden\n          onChange={handleFileChange}\n\t\t\t\t\trequired\n        />\n      \t<Button\n\t\t\t\t\tid='buttonChooseFile'\n          content='Choose File'\n          labelPosition='left'\n          icon='file'\n          onClick={() => fileInputRef.current.click()}\n        />\n\t\t\t</Form.Field>\n\t\t\t<Button\n        type='submit'>\n        Submit\n      </Button>\n    </Form>\n\t\t<br/>\n\t\t<RecordVerified />\n\t\t</>\n  )\n}\n\nexport default Verify;\n"]},"metadata":{},"sourceType":"module"}