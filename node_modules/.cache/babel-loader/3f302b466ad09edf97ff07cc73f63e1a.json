{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useReducer}from'react';import GetWeb3 from'./utils/GetWeb3';import Reducer from'./store/Reducer';import InitialState from'./store/InitialState';import Context from'./store/Context';import AddRecord from'./components/AddRecord';import Sijil from'./contracts/Sijil.json';import Admin from'./components/Admin';import GetRecords from'./components/GetRecords';import{Container,Message}from'semantic-ui-react';import Header from'./components/Header';import Verify from'./components/Verify';import{BrowserRouter,Switch,Route}from'react-router-dom';function App(){var _useReducer=useReducer(Reducer,InitialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,accounts,networkId,deployedNetwork,contract;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return GetWeb3();case 2:web3=_context.sent;_context.next=5;return web3.eth.getAccounts();case 5:accounts=_context.sent;_context.next=8;return web3.eth.net.getId();case 8:networkId=_context.sent;deployedNetwork=Sijil.networks[networkId];contract=new web3.eth.Contract(Sijil.abi,deployedNetwork&&deployedNetwork.address);// set the web3 instance to a global variable\ndispatch({type:'SET_WEB3',payload:web3});// set accounts to a global variable\ndispatch({type:'SET_ACCOUNTS',payload:accounts});// set the contract instance to a global variable\ndispatch({type:'SET_CONTRACT',payload:contract});// get admin (ministry) address\ncontract.methods.ministryOfEducation().call().then(function(res){var isAdmin=res===accounts[0];dispatch({type:'SET_IS_ADMIN',payload:isAdmin});});// isApproved\ncontract.methods.isApproved(accounts[0]).call().then(function(res){return dispatch({type:'SET_IS_APPROVED',payload:res});});// get records\ncontract.methods.getRecords().call().then(function(res){return dispatch({type:'SET_RECORDS',payload:res});});// get institutions\ncontract.methods.getInstitutions().call().then(function(res){return dispatch({type:'SET_INSTITUTIONS',payload:res});});// get current pathname\ndispatch({type:'SET_ACTIVE_ITEM',payload:window.location.pathname.replace('/','')});case 19:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();// launch the init function\ninit();// if the account of metamask change, the accounts will be updated\nwindow.ethereum.on('accountsChanged',function(accounts){dispatch({type:'SET_ACCOUNTS',payload:accounts});});},[]);if(state&&!state.loading){return/*#__PURE__*/React.createElement(Context.Provider,{value:{state:state,dispatch:dispatch}},/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(BrowserRouter,null,/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/add\"},/*#__PURE__*/React.createElement(AddRecord,null)),/*#__PURE__*/React.createElement(Route,{path:\"/verify\"},/*#__PURE__*/React.createElement(Verify,null)),/*#__PURE__*/React.createElement(Route,{path:\"\"},state.isAdmin?/*#__PURE__*/React.createElement(Admin,null):!state.isApproved?/*#__PURE__*/React.createElement(Verify,null):state.records.length>0?/*#__PURE__*/React.createElement(GetRecords,null):/*#__PURE__*/React.createElement(Message,{visibel:true},\"No records.\"))))));}else{return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",null,\"Loading...\"));}}export default App;","map":{"version":3,"sources":["/Users/zaralaila/Desktop/sijil/src/App.js"],"names":["React","useEffect","useReducer","GetWeb3","Reducer","InitialState","Context","AddRecord","Sijil","Admin","GetRecords","Container","Message","Header","Verify","BrowserRouter","Switch","Route","App","state","dispatch","init","web3","eth","getAccounts","accounts","net","getId","networkId","deployedNetwork","networks","contract","Contract","abi","address","type","payload","methods","ministryOfEducation","call","then","res","isAdmin","isApproved","getRecords","getInstitutions","window","location","pathname","replace","ethereum","on","loading","records","length"],"mappings":"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","sourcesContent":["import React, {useEffect, useReducer} from 'react';\nimport GetWeb3 from './utils/GetWeb3';\nimport Reducer from './store/Reducer';\nimport InitialState from './store/InitialState';\nimport Context from './store/Context';\nimport AddRecord from './components/AddRecord';\nimport Sijil from './contracts/Sijil.json';\nimport Admin from './components/Admin';\nimport GetRecords from './components/GetRecords';\nimport {Container, Message} from 'semantic-ui-react';\nimport Header from './components/Header';\nimport Verify from './components/Verify';\nimport {BrowserRouter, Switch, Route} from 'react-router-dom';\n\nfunction App() {\n  const [state, dispatch] = useReducer(Reducer, InitialState);\n\n  useEffect(() => {\n    const init = async () => {\n\t\t\t// get web3 instance\n      const web3 = await GetWeb3();\n\t\t\t\n\t\t\t// get accounts      \n\t\t\tconst accounts = await web3.eth.getAccounts();\n\n\t\t\t// get the contract instance from the blockchain\n      const networkId = await web3.eth.net.getId();\n      const deployedNetwork = Sijil.networks[networkId];      \n\t\t\tconst contract = new web3.eth.Contract(\n        Sijil.abi,\n        deployedNetwork && deployedNetwork.address,\n      );\n\t\t\t\n\t\t\t// set the web3 instance to a global variable\n      dispatch({type: 'SET_WEB3', payload: web3});\n\n\t\t\t// set accounts to a global variable\n      dispatch({type: 'SET_ACCOUNTS', payload: accounts});\n      \n\t\t\t// set the contract instance to a global variable\n\t\t\tdispatch({type: 'SET_CONTRACT', payload: contract});\n\n\t\t\t// get admin (ministry) address\n\t\t\tcontract.methods.ministryOfEducation().call()\n\t\t\t\t.then(res => {\n\t\t\t\t\tlet isAdmin = res === accounts[0];\n\t\t\t\t\tdispatch({type: 'SET_IS_ADMIN', payload: isAdmin})\n\t\t\t\t});\n\n\t\t\t// isApproved\n\t\t\tcontract.methods.isApproved(accounts[0]).call()\n\t\t\t\t.then(res => dispatch({type: 'SET_IS_APPROVED', payload: res}));\n\n\t\t\t// get records\n\t\t\tcontract.methods.getRecords().call()\n\t\t\t\t.then(res => dispatch({type: 'SET_RECORDS', payload: res}));\n    \t\n\t\t\t// get institutions\n\t\t\tcontract.methods.getInstitutions().call()\n\t\t\t.then(res => dispatch({type: 'SET_INSTITUTIONS', payload: res}));\n\n\t\t\t// get current pathname\n\t\t\tdispatch({\n\t\t\t\ttype: 'SET_ACTIVE_ITEM',\n\t\t\t\tpayload: window.location.pathname.replace('/', '')\n\t\t\t});\n\t\t\n\t\t}\n\n\t\t// launch the init function\n    init();\n\n\t\t// if the account of metamask change, the accounts will be updated\n    window.ethereum.on('accountsChanged', accounts => {\n      dispatch({type: 'SET_ACCOUNTS', payload: accounts});\n    });\n  }, []);\n\n  if (state && !state.loading) {\n\t\treturn (\t\n\t\t\t<Context.Provider value={{state, dispatch}}>\n\t\t\t\t<Container>\n\t\t\t\t<BrowserRouter>\n\t\t\t\t\t<Header />\n\t\t\t\t\t<Switch>\n\t\t\t\t\t\t<Route path='/add'>\n\t\t\t\t\t\t\t<AddRecord />\n\t\t\t\t\t\t</Route>\n\t\t\t\t\t\t<Route path='/verify'>\n\t\t\t\t\t\t\t<Verify />\n\t\t\t\t\t\t</Route>\n\t\t\t\t\t\t<Route path=''>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate.isAdmin ?\n\t\t\t\t\t\t\t<Admin /> : !state.isApproved ? <Verify /> :\n\t\t\t\t\t\t\tstate.records.length > 0 ? \n\t\t\t\t\t\t\t\t<GetRecords /> : \n\t\t\t\t\t\t\t\t<Message visibel>No records.</Message>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</Route>\n\t\t\t\t\t</Switch>\n\t\t\t\t</BrowserRouter>\n\t\t\t\t</Container>\n\t\t\t</Context.Provider>\n\t\t);\n\t} else {\n    return (\n      <Container>\n\t\t\t\t<br /><br />\n      \t<h2>Loading...</h2>\n      </Container>\n    )\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}