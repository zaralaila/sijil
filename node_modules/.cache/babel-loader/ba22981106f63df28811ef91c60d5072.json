{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/zaralaila/Desktop/sijil/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useContext}from'react';import Context from'../store/Context';import sha256 from'crypto-js/sha256';import{Form,Button}from'semantic-ui-react';var AddRecord=function AddRecord(){var _useContext=useContext(Context),state=_useContext.state,dispatch=_useContext.dispatch;var fileInputRef=useRef();var _useState=useState(),_useState2=_slicedToArray(_useState,2),hash=_useState2[0],setHash=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),studentID=_useState4[0],setStudentId=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),studentName=_useState6[0],setStudentName=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),programme=_useState8[0],setProgramme=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),result=_useState10[0],setResult=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),modeOfStudy=_useState12[0],setModeOfStudy=_useState12[1];var handleFileChange=function handleFileChange(e){var file=e.target.files[0];var reader=new window.FileReader();reader.readAsBinaryString(file);reader.onloadend=function(){setHash(sha256(reader.result).toString());};document.getElementById('buttonChooseFile').innerHTML=\"<i aria-hidden=\\\"true\\\" class=\\\"file icon\\\"></i>\".concat(file.name);};var handleStudentIdChange=function handleStudentIdChange(e){setStudentId(e.target.value);};var handleStudentNameChange=function handleStudentNameChange(e){setStudentName(e.target.value);};var handleProgrammeChange=function handleProgrammeChange(e){setProgramme(e.target.value);};var handleResultChange=function handleResultChange(e){setResult(e.target.value);};var handleModeOfStudyChange=function handleModeOfStudyChange(e){setModeOfStudy(e.target.value);};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var isHashExist,date_ob,year,month,day,date,records;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;dispatch({type:'SET_LOADING',payload:true});// verify is hash exist\n_context.next=5;return state.contract.methods.isHashExist(hash).call();case 5:isHashExist=_context.sent;if(isHashExist){_context.next=21;break;}date_ob=new Date();year=date_ob.getFullYear();month=(\"0\"+(date_ob.getMonth()+1)).slice(-2);day=(\"0\"+date_ob.getDate()).slice(-2);date=\"\".concat(day,\"-\").concat(month,\"-\").concat(year);_context.next=14;return state.contract.methods.addRecord(studentID,studentName,programme,result,modeOfStudy,hash,date).send({from:state.accounts[0]});case 14:dispatch({type:'SET_NOTIF',payload:{msg:'record added.',success:true}});_context.next=17;return state.contract.methods.getRecords().call();case 17:records=_context.sent;dispatch({type:'SET_RECORDS',payload:records});_context.next=22;break;case 21:dispatch({type:'SET_MESSAGE_HASH_EXIST',payload:'Doc is already exist.'});case 22:_context.next=27;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](1);dispatch({type:'SET_NOTIF',payload:{msg:_context.t0.message,success:false}});case 27:_context.prev=27;dispatch({type:'SET_LOADING',payload:false});return _context.finish(27);case 30:case\"end\":return _context.stop();}}},_callee,null,[[1,24,27,30]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,state.messageIfHashExist&&/*#__PURE__*/React.createElement(\"div\",null,state.messageIfHashExist),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Form,{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"File\"),/*#__PURE__*/React.createElement(\"input\",{ref:fileInputRef,type:\"file\",hidden:true,onChange:handleFileChange,required:true}),/*#__PURE__*/React.createElement(Button,{id:\"buttonChooseFile\",content:\"Choose File\",labelPosition:\"left\",icon:\"file\",onClick:function onClick(){return fileInputRef.current.click();}})),/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Student ID\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",onChange:handleStudentIdChange,required:true})),/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Student Name\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",onChange:handleStudentNameChange,required:true})),/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Programme\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",onChange:handleProgrammeChange,required:true})),/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Result\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",onChange:handleResultChange,required:true})),/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Mode of study\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",onChange:handleModeOfStudyChange,required:true})),/*#__PURE__*/React.createElement(Button,{type:\"submit\"},\"submit\")));};export default AddRecord;","map":{"version":3,"sources":["/Users/zaralaila/Desktop/sijil/src/components/AddRecord.js"],"names":["React","useRef","useState","useContext","Context","sha256","Form","Button","AddRecord","state","dispatch","fileInputRef","hash","setHash","studentID","setStudentId","studentName","setStudentName","programme","setProgramme","result","setResult","modeOfStudy","setModeOfStudy","handleFileChange","e","file","target","files","reader","window","FileReader","readAsBinaryString","onloadend","toString","document","getElementById","innerHTML","name","handleStudentIdChange","value","handleStudentNameChange","handleProgrammeChange","handleResultChange","handleModeOfStudyChange","handleSubmit","preventDefault","type","payload","contract","methods","isHashExist","call","date_ob","Date","year","getFullYear","month","getMonth","slice","day","getDate","date","addRecord","send","from","accounts","msg","success","getRecords","records","message","messageIfHashExist","current","click"],"mappings":"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","sourcesContent":["import React, {useRef, useState, useContext} from 'react';\nimport Context from '../store/Context';\nimport sha256 from 'crypto-js/sha256';\nimport {Form, Button} from 'semantic-ui-react';\n\nconst AddRecord = () => {\n  const {state, dispatch} = useContext(Context);\n\tconst fileInputRef = useRef();\n  const [hash, setHash] = useState();\n  const [studentID, setStudentId] = useState();\n\tconst [studentName, setStudentName] = useState();\n\tconst [programme, setProgramme] = useState();\n\tconst [result, setResult] = useState();\n\tconst [modeOfStudy, setModeOfStudy] = useState();\n\n  const handleFileChange = e => {\n    const file = e.target.files[0];\n    const reader = new window.FileReader();\n    reader.readAsBinaryString(file);\n    reader.onloadend = () => {\n      setHash(sha256(reader.result).toString());\n    }\n\t\tdocument.getElementById('buttonChooseFile')\n\t\t\t.innerHTML = `<i aria-hidden=\"true\" class=\"file icon\"></i>${file.name}`;\n  }\n\n  const handleStudentIdChange = e => {\n    setStudentId(e.target.value);\n  }\n\n\tconst handleStudentNameChange = e => {\n\t\tsetStudentName(e.target.value);\n\t}\n\n\tconst handleProgrammeChange = e => {\n\t\tsetProgramme(e.target.value);\n\t}\n\n\tconst handleResultChange = e => {\n\t\tsetResult(e.target.value);\n\t}\n\n\tconst handleModeOfStudyChange = e => {\n\t\tsetModeOfStudy(e.target.value);\n\t}\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    try {\n      dispatch({type: 'SET_LOADING', payload: true});\n\t\t\t// verify is hash exist\n\t\t\tlet isHashExist = await state.contract.methods.isHashExist(hash).call();\n\t\t\tif(!isHashExist) {\n\t\t\t\tlet date_ob = new Date();\n \t\t\t\tlet year = date_ob.getFullYear();\n \t\t\t\tlet month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\n \t\t\t\tlet day = (\"0\" + date_ob.getDate()).slice(-2);\n      \tlet date = `${day}-${month}-${year}`;\n\t\t\t\tawait state.contract.methods\n        \t.addRecord(studentID, studentName, programme,\n\t\t\t\t\t\tresult, modeOfStudy, hash, date)\n        \t.send({from: state.accounts[0]});\n      \tdispatch({\n        \ttype: 'SET_NOTIF',\n        \tpayload: {msg: 'record added.', success: true}\n      \t});\n\t\t\t\tconst records = await state.contract.methods\n\t\t\t\t\t.getRecords().call();\n\t\t\t\tdispatch({\n\t\t\t\t\ttype: 'SET_RECORDS',\n\t\t\t\t\tpayload: records\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdispatch({\n\t\t\t\t\ttype: 'SET_MESSAGE_HASH_EXIST', \n\t\t\t\t\tpayload: 'Doc is already exist.'\n\t\t\t\t});\n\t\t\t}\n    } catch (error) {\n      dispatch({\n        type: 'SET_NOTIF',\n        payload: {msg: error.message, success: false}\n      });\n    } finally {\n      dispatch({type: 'SET_LOADING', payload: false});\n    }\n  }\n\n  return (\n\t\t<>\n\t\t{state.messageIfHashExist && <div>{state.messageIfHashExist}</div>}\n\t\t<br/>\n    <Form onSubmit={handleSubmit}>\n      <Form.Field>\n\t\t\t\t<label>File</label>\n        <input\n\t\t\t\t\tref={fileInputRef}\n          type='file'\n          hidden\n          onChange={handleFileChange}\n\t\t\t\t\trequired\n        />\n      \t<Button\n\t\t\t\t\tid='buttonChooseFile'\n          content='Choose File'\n          labelPosition='left'\n          icon='file'\n          onClick={() => fileInputRef.current.click()}\n        />\n\t\t\t</Form.Field>\n\t\t\t<Form.Field>\n      \t<label>Student ID</label>\n      \t<input\n        \ttype='text'\n        \tonChange={handleStudentIdChange}\n        \trequired />\n      </Form.Field>\n\t\t\t<Form.Field>\n      \t<label>Student Name</label>\n      \t<input\n        \ttype='text'\n        \tonChange={handleStudentNameChange}\n        \trequired />\n      </Form.Field>\n\t\t\t<Form.Field>\n      \t<label>Programme</label>\n      \t<input\n        \ttype='text'\n        \tonChange={handleProgrammeChange}\n        \trequired />\n      </Form.Field>\n\t\t\t<Form.Field>\n      \t<label>Result</label>\n      \t<input\n        \ttype='text'\n        \tonChange={handleResultChange}\n        \trequired />\n      </Form.Field>\n\t\t\t<Form.Field>\n      \t<label>Mode of study</label>\n      \t<input\n        \ttype='text'\n        \tonChange={handleModeOfStudyChange}\n        \trequired />\n      </Form.Field>\n\t\t\t<Button\n        type='submit'>\n        submit\n      </Button>\n    </Form>\n\t\t</>\n  )\n}\n\nexport default AddRecord;\n"]},"metadata":{},"sourceType":"module"}